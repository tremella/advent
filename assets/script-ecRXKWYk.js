import"./vendor_p5js-wrapper-Hbg_u1xl.js";import"./vendor_p5-hFoC1Msr.js";import"./vendor_exenv-rXw0U8dN.js";function V(){const P=document.getElementById("snowflake");if(document.getElementById("snowflakeEmbed"))return;const w=document.createElement("div"),b=document.createElement("h1");b.innerText="Snowflake Craft Station",w.append(b);const C=document.createElement("p");C.innerText="Click and drag to cut the snowflake. Click 'Unfold Snowflake' to see the full design.",w.append(C);const E=document.createElement("button");E.innerText="Reset",w.append(E);const v=document.createElement("button");v.innerText="Unfold Snowflake",w.append(v);const L=document.createElement("div");L.id="snowflakeEmbed",w.append(L),P.append(w);const R=n=>{let y,m=[],Y=!1,c=null,a,M=n.windowWidth,B=n.windowHeight;n.setup=()=>{console.log("window dimensions",M,B);let e=Math.min(M,B)*.6;console.log("canvas dimensions",e),n.createCanvas(e,e),y=n.createGraphics(200,200),a=[{x:0,y:0,ordinal:0},{x:n.width/2.3,y:0,ordinal:500},{x:n.width/2.3-1,y:n.height/4,ordinal:1e3}],y.translate(n.width/2,n.height/2),E.onclick=G,v.onclick=F,n.background(255)},n.draw=()=>{if(n.translate(n.width/2,n.height/2),n.strokeWeight(1),n.stroke("#000"),n.background("#901a1a"),Y)n.stroke("#CCC"),A();else if(n.stroke("#000"),n.strokeWeight(2),D(),c){c.endX=n.mouseX-n.width/2,c.endY=n.mouseY-n.height/2;let{startX:e,startY:t,endX:o,endY:l}=c;n.line(e,t,o,l)}},n.mousePressed=()=>{if(!Y&&n.mouseX>0&&n.mouseX<n.width&&n.mouseY>0&&n.mouseY<n.height){let e=n.mouseX-n.width/2,t=n.mouseY-n.height/2;c={startX:e,startY:t,endX:null,endY:null}}},n.mouseReleased=()=>{if(c){let e=[];for(let l=0;l<a.length;l++){let i=a[l],r;l==0?r=a[a.length-1]:r=a[l-1];let d=U(r.x,r.y,i.x,i.y,c.startX,c.startY,c.endX,c.endY);d&&d.x&&(d.previous=i,d.flakeIndex=l,d.ordinal=O(r,i),e.push(d))}console.log("found "+e.length+" edge intersections");for(let l of m){let i=U(l.startX,l.startY,l.endX,l.endY,c.startX,c.startY,c.endX,c.endY);i&&(i.flakeIndex=null,i.cutLine=l,e.push(i))}console.log("found "+e.length+" edge and cutline intersections");let t={x:c.startX,y:c.startY},o={x:c.endX,y:c.endY};if(e.length==1)e[0].snap?e[0].snap=="start"?k(e[0],o):e[0].snap=="end"&&k(e[0],t):q(e[0],t,o);else if(e.length==2)X(e);else if(e.length>=3){let l=J(t,e),i=S(t,a),r=S(o,a);X(i?[l[1],l[2]]:r?[l[1],l[0]]:[l[0],l[1]])}n.push(),n.fill("red"),n.strokeWeight(20),n.pop(),c=null}};function O(e,t){if(e.ordinal>0&&t.ordinal>0)return(e.ordinal+t.ordinal)/2;if(e.ordinal==0&&a.indexOf(t)==1||t.ordinal==0&&a.indexOf(e)==1)return(e.ordinal+t.ordinal)/2;if(t.ordinal>0)return t.ordinal+500;if(e.ordinal>0)return e.ordinal+500}function q(e,t,o){let l=S(t,a),i=S(o,a);l&&i?(console.log("both inside"),k(t,o)):l?k(e,t):i?k(e,o):console.log("no point")}function k(e,t){console.log("created cut at order "+e.ordinal),m.push({startX:e.x,startY:e.y,endX:t.x,endY:t.y,ordinal:e.ordinal}),a.splice(e.flakeIndex,0,e),a.sort((o,l)=>o.ordinal>l.ordinal?1:-1)}function X(e){if(e[0].ordinal==null||e[1].ordinal==null){let t=[];if(e[0].ordinal==null&&e[1].ordinal==null){console.log("interior cut");return}else{console.log("exterior cut");let o,l;e[0].ordinal==null?(o=e[1],l=e[0]):(o=e[0],l=e[1]);let i=l.cutLine,r={x:i.startX,y:i.startY,ordinal:i.ordinal};console.log("other line",i),console.log("side point order "+o.ordinal),console.log("other line order "+i.ordinal);let d=[],f=[],u=Math.max(o.ordinal,i.ordinal),g=Math.min(o.ordinal,i.ordinal);a.forEach(s=>{if(s.ordinal>g&&s.ordinal<u)d.push(s);else{if(s.ordinal==g||s.ordinal==u)return;f.push(s)}});let h=d;d.length>f.length&&(h=f),console.log("removing "+h.length+" points"),h.length==0?(l.ordinal=O(o,r),console.log("cut point ordinal "+l.ordinal),t=[l,o]):(l.ordinal=h[0].ordinal,a=a.filter(s=>!h.includes(s)),t=[l,o]),a=a.concat(t),e.forEach(s=>{s.cutLine&&(m=m.filter(x=>x!=s.cutLine))})}}else console.log("chopping from "+e[0].ordinal+" to "+e[1].ordinal),a=z(a,e[0],e[1]);a.sort((t,o)=>t.ordinal>o.ordinal?1:-1),m=m.filter(t=>a.some(o=>o.x==t.startX&&o.y==t.startY))}function D(){n.push(),n.fill("#f1eeeb"),n.beginShape();for(let e=0;e<a.length;e++)n.vertex(a[e].x,a[e].y);n.endShape(n.CLOSE);for(let e of m)n.line(e.startX,e.startY,e.endX,e.endY);n.pop();for(let e=0;e<a.length;e++);n.image(y,0,0)}function A(){for(let e=0;e<12;e++)n.push(),n.rotate(n.PI*e/6),e%2==1&&(n.scale(-1,1),n.rotate(n.PI*5/6)),D(),n.pop()}function F(){Y=!0}function G(){Y=!1,y.clear(),a=[{x:0,y:0,ordinal:0},{x:n.width/2.3,y:0,ordinal:500},{x:n.width/2.3-1,y:n.height/4,ordinal:1e3}],m=[]}function W(e,t,o,l){return(l-t)/(o-e)}function T(e,t,o){return t-o*e}function I(e,t,o){return Math.min(e,t)<=o&&o<=Math.max(e,t)}function U(e,t,o,l,i,r,d,f){let u=W(e,t,o,l),g=W(i,r,d,f);if(u===g)return null;let h=T(e,t,u),x=(T(i,r,g)-h)/(u-g),p=u*x+h;return I(e,o,x)&&I(t,l,p)&&I(i,d,x)&&I(r,f,p)?{x,y:p}:null}function S(e,t){let o=e.x,l=e.y,i=!1;for(let r=0,d=t.length-1;r<t.length;d=r++){let f=t[r].x,u=t[r].y,g=t[d].x,h=t[d].y;u>l!=h>l&&o<(g-f)*(l-u)/(h-u)+f&&(i=!i)}return i}function z(e,t,o){let l=t.flakeIndex,i=o.flakeIndex,r={x:t.x,y:t.y,ordinal:t.ordinal},d={x:o.x,y:o.y,ordinal:o.ordinal},f=[];if(console.log("removing from "+l+" to "+i),l===i)return console.log("both indexes the same"),e;let u=e.length,g=(i-l+u)%u,h=(l-i+u)%u;return g<h?(console.log("forward"),l<i?(console.log("1 first"),f=e.slice(0,l).concat(r,d).concat(e.slice(i))):(console.log("2 first"),f=e.slice(i,l+1).concat(d,r))):(console.log("backward"),l<i?(console.log("1 first"),f=e.slice(l,i).concat(d,r)):(console.log("2 first"),f=e.slice(0,i).concat(d,r).concat(e.slice(l)))),f=f.filter((s,x,p)=>x===p.findIndex(H=>H.x===s.x&&H.y===s.y)),f}function j(e,t,o,l){return Math.sqrt(Math.pow(o-e,2)+Math.pow(l-t,2))}function J(e,t){let o=t.slice();return o.sort((l,i)=>{let r=j(e.x,e.y,l.x,l.y),d=j(e.x,e.y,i.x,i.y);return r-d}),o}};new p5(R,P)}export{V as run};
