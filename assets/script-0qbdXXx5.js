import"./vendor_p5js-wrapper-Hbg_u1xl.js";import"./vendor_p5-hFoC1Msr.js";import"./vendor_exenv-rXw0U8dN.js";function K(){const S=document.getElementById("snowflake");if(document.getElementById("snowflakeEmbed"))return;const L=document.createElement("div");L.id="snowflakeEmbed",S.append(L);const j=l=>{let y,P,b,x=[],Y=!1,f=null,r,v=l.windowWidth/2;l.setup=()=>{l.createCanvas(v,v),y=l.createGraphics(200,200),r=[{x:0,y:0,ordinal:0},{x:l.width/2.3,y:0,ordinal:500},{x:l.width/2.3-1,y:l.height/4,ordinal:1e3}],y.translate(l.width/2,l.height/2),P=l.createButton("Unfold Snowflake"),P.position(10,10),P.mousePressed(q),b=l.createButton("Reset"),b.position(10,50),b.mousePressed(A),l.background(255)},l.draw=()=>{if(l.translate(l.width/2,l.height/2),l.strokeWeight(1),l.stroke("#ddd5cb"),l.background("#bc4749"),Y)R();else if(l.stroke("#003e1f"),B(),f){f.endX=l.mouseX-l.width/2,f.endY=l.mouseY-l.height/2;let{startX:e,startY:n,endX:o,endY:t}=f;l.line(e,n,o,t)}},l.mousePressed=()=>{if(!Y&&l.mouseX>0&&l.mouseX<l.width&&l.mouseY>0&&l.mouseY<l.height){let e=l.mouseX-l.width/2,n=l.mouseY-l.height/2;f={startX:e,startY:n,endX:null,endY:null}}},l.mouseReleased=()=>{if(f){let e=[];for(let t=0;t<r.length;t++){let i=r[t],a;t==0?a=r[r.length-1]:a=r[t-1];let d=O(a.x,a.y,i.x,i.y,f.startX,f.startY,f.endX,f.endY);d&&d.x&&(d.previous=i,d.flakeIndex=t,d.ordinal=E(a,i),e.push(d))}console.log("found "+e.length+" edge intersections");for(let t of x){let i=O(t.startX,t.startY,t.endX,t.endY,f.startX,f.startY,f.endX,f.endY);i&&(i.flakeIndex=null,i.cutLine=t,e.push(i))}console.log("found "+e.length+" edge and cutline intersections");let n={x:f.startX,y:f.startY},o={x:f.endX,y:f.endY};if(e.length==1)e[0].snap?e[0].snap=="start"?w(e[0],o):e[0].snap=="end"&&w(e[0],n):U(e[0],n,o);else if(e.length==2)X(e);else if(e.length>=3){let t=G(n,e),i=I(n,r),a=I(o,r);X(i?[t[1],t[2]]:a?[t[1],t[0]]:[t[0],t[1]])}l.push(),l.fill("red"),l.strokeWeight(20),l.pop(),f=null}};function E(e,n){if(e.ordinal>0&&n.ordinal>0)return(e.ordinal+n.ordinal)/2;if(e.ordinal==0&&r.indexOf(n)==1||n.ordinal==0&&r.indexOf(e)==1)return(e.ordinal+n.ordinal)/2;if(n.ordinal>0)return n.ordinal+500;if(e.ordinal>0)return e.ordinal+500}function U(e,n,o){let t=I(n,r),i=I(o,r);t&&i?(console.log("both inside"),w(n,o)):t?w(e,n):i?w(e,o):console.log("no point")}function w(e,n){console.log("created cut at order "+e.ordinal),x.push({startX:e.x,startY:e.y,endX:n.x,endY:n.y,ordinal:e.ordinal}),r.splice(e.flakeIndex,0,e),r.sort((o,t)=>o.ordinal>t.ordinal?1:-1)}function X(e){if(e[0].ordinal==null||e[1].ordinal==null){let n=[];if(e[0].ordinal==null&&e[1].ordinal==null){console.log("interior cut");return}else{console.log("exterior cut");let o,t;e[0].ordinal==null?(o=e[1],t=e[0]):(o=e[0],t=e[1]);let i=t.cutLine,a={x:i.startX,y:i.startY,ordinal:i.ordinal};console.log("other line",i),console.log("side point order "+o.ordinal),console.log("other line order "+i.ordinal);let d=[],u=[],c=Math.max(o.ordinal,i.ordinal),g=Math.min(o.ordinal,i.ordinal);r.forEach(s=>{if(s.ordinal>g&&s.ordinal<c)d.push(s);else{if(s.ordinal==g||s.ordinal==c)return;u.push(s)}});let h=d;d.length>u.length&&(h=u),console.log("removing "+h.length+" points"),h.length==0?(t.ordinal=E(o,a),console.log("cut point ordinal "+t.ordinal),n=[t,o]):(t.ordinal=h[0].ordinal,r=r.filter(s=>!h.includes(s)),n=[t,o]),r=r.concat(n),e.forEach(s=>{s.cutLine&&(x=x.filter(m=>m!=s.cutLine))})}}else console.log("chopping from "+e[0].ordinal+" to "+e[1].ordinal),r=F(r,e[0],e[1]);r.sort((n,o)=>n.ordinal>o.ordinal?1:-1),x=x.filter(n=>r.some(o=>o.x==n.startX&&o.y==n.startY))}function B(){l.push(),l.fill("#f1eeeb"),l.beginShape();for(let e=0;e<r.length;e++)l.vertex(r[e].x,r[e].y);l.endShape(l.CLOSE);for(let e of x)l.line(e.startX,e.startY,e.endX,e.endY);l.pop();for(let e=0;e<r.length;e++);l.image(y,0,0)}function R(){for(let e=0;e<12;e++)l.push(),l.rotate(l.PI*e/6),e%2==1&&(l.scale(-1,1),l.rotate(l.PI*5/6)),B(),l.pop()}function q(){Y=!0}function A(){Y=!1,y.clear(),r=[{x:0,y:0,ordinal:0},{x:l.width/2.3,y:0,ordinal:500},{x:l.width/2.3-1,y:l.height/4,ordinal:1e3}],x=[]}function M(e,n,o,t){return(t-n)/(o-e)}function C(e,n,o){return n-o*e}function p(e,n,o){return Math.min(e,n)<=o&&o<=Math.max(e,n)}function O(e,n,o,t,i,a,d,u){let c=M(e,n,o,t),g=M(i,a,d,u);if(c===g)return null;let h=C(e,n,c),m=(C(i,a,g)-h)/(c-g),k=c*m+h;return p(e,o,m)&&p(n,t,k)&&p(i,d,m)&&p(a,u,k)?{x:m,y:k}:null}function I(e,n){let o=e.x,t=e.y,i=!1;for(let a=0,d=n.length-1;a<n.length;d=a++){let u=n[a].x,c=n[a].y,g=n[d].x,h=n[d].y;c>t!=h>t&&o<(g-u)*(t-c)/(h-c)+u&&(i=!i)}return i}function F(e,n,o){let t=n.flakeIndex,i=o.flakeIndex,a={x:n.x,y:n.y,ordinal:n.ordinal},d={x:o.x,y:o.y,ordinal:o.ordinal},u=[];if(console.log("removing from "+t+" to "+i),t===i)return console.log("both indexes the same"),e;let c=e.length,g=(i-t+c)%c,h=(t-i+c)%c;return g<h?(console.log("forward"),t<i?(console.log("1 first"),u=e.slice(0,t).concat(a,d).concat(e.slice(i))):(console.log("2 first"),u=e.slice(i,t+1).concat(d,a))):(console.log("backward"),t<i?(console.log("1 first"),u=e.slice(t,i).concat(d,a)):(console.log("2 first"),u=e.slice(0,i).concat(d,a).concat(e.slice(t)))),u=u.filter((s,m,k)=>m===k.findIndex(W=>W.x===s.x&&W.y===s.y)),u}function D(e,n,o,t){return Math.sqrt(Math.pow(o-e,2)+Math.pow(t-n,2))}function G(e,n){let o=n.slice();return o.sort((t,i)=>{let a=D(e.x,e.y,t.x,t.y),d=D(e.x,e.y,i.x,i.y);return a-d}),o}};new p5(j,S)}export{K as run};
