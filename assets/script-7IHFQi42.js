import"./vendor_p5js-wrapper-Hbg_u1xl.js";import"./vendor_p5-hFoC1Msr.js";import"./vendor_exenv-rXw0U8dN.js";function N(){const y=document.getElementById("snowflake");if(document.getElementById("snowflakeEmbed"))return;const k=document.createElement("div"),P=document.createElement("h1");P.innerText="Snowflake Craft Station",k.append(P);const C=document.createElement("p");C.innerText="Click and drag to cut the snowflake. Click 'Unfold Snowflake' to see the full design.",k.append(C);const S=document.createElement("button");S.innerText="Reset",k.append(S);const L=document.createElement("button");L.innerText="Unfold Snowflake",k.append(L);const b=document.createElement("div");b.id="snowflakeEmbed",k.append(b),y.append(k);const j=n=>{let Y,x=[],X=!1,f=null,o;n.windowWidth,n.windowHeight,n.setup=()=>{let e=Math.min(y.clientWidth,y.clientHeight),t=n.createCanvas(e,e);Y=n.createGraphics(200,200),o=[{x:0,y:0,ordinal:0},{x:n.width/2.3,y:0,ordinal:500},{x:n.width/2.3-1,y:n.height/4,ordinal:1e3}],Y.translate(n.width/2,n.height/2),S.onclick=A,L.onclick=q,n.background(255);function i(l){l.preventDefault()}t.parent("snowflakeEmbed"),t.elt.addEventListener("touchstart",i,{passive:!1}),t.elt.addEventListener("touchmove",i,{passive:!1}),t.elt.addEventListener("touchend",i,{passive:!1})},n.draw=()=>{if(n.translate(n.width/2,n.height/2),n.strokeWeight(1),n.stroke("#000"),n.background("#901a1a"),X)n.stroke("#CCC"),R();else if(n.stroke("#000"),n.strokeWeight(2),B(),f){f.endX=n.mouseX-n.width/2,f.endY=n.mouseY-n.height/2;let{startX:e,startY:t,endX:i,endY:l}=f;n.line(e,t,i,l)}},n.mousePressed=()=>{if(!X&&n.mouseX>0&&n.mouseX<n.width&&n.mouseY>0&&n.mouseY<n.height){let e=n.mouseX-n.width/2,t=n.mouseY-n.height/2;f={startX:e,startY:t,endX:null,endY:null}}},n.mouseReleased=()=>{if(f){let e=[];for(let l=0;l<o.length;l++){let a=o[l],r;l==0?r=o[o.length-1]:r=o[l-1];let d=W(r.x,r.y,a.x,a.y,f.startX,f.startY,f.endX,f.endY);d&&d.x&&(d.previous=a,d.flakeIndex=l,d.ordinal=M(r,a),e.push(d))}for(let l of x){let a=W(l.startX,l.startY,l.endX,l.endY,f.startX,f.startY,f.endX,f.endY);a&&(a.flakeIndex=null,a.cutLine=l,e.push(a))}let t={x:f.startX,y:f.startY},i={x:f.endX,y:f.endY};if(e.length==1)e[0].snap?e[0].snap=="start"?g(e[0],i):e[0].snap=="end"&&g(e[0],t):H(e[0],t,i);else if(e.length==2)v(e);else if(e.length>=3){let l=G(t,e),a=E(t,o),r=E(i,o);v(a?[l[1],l[2]]:r?[l[1],l[0]]:[l[0],l[1]])}n.push(),n.fill("red"),n.strokeWeight(20),n.pop(),f=null}};function M(e,t){if(e.ordinal>0&&t.ordinal>0)return(e.ordinal+t.ordinal)/2;if(e.ordinal==0&&o.indexOf(t)==1||t.ordinal==0&&o.indexOf(e)==1)return(e.ordinal+t.ordinal)/2;if(t.ordinal>0)return t.ordinal+500;if(e.ordinal>0)return e.ordinal+500}function H(e,t,i){let l=E(t,o),a=E(i,o);l&&a?g(t,i):l?g(e,t):a&&g(e,i)}function g(e,t){x.push({startX:e.x,startY:e.y,endX:t.x,endY:t.y,ordinal:e.ordinal}),o.splice(e.flakeIndex,0,e),o.sort((i,l)=>i.ordinal>l.ordinal?1:-1)}function v(e){if(e[0].ordinal==null||e[1].ordinal==null){let t=[];if(e[0].ordinal==null&&e[1].ordinal==null)return;{let i,l;e[0].ordinal==null?(i=e[1],l=e[0]):(i=e[0],l=e[1]);let a=l.cutLine,r={x:a.startX,y:a.startY,ordinal:a.ordinal},d=[],u=[],c=Math.max(i.ordinal,a.ordinal),m=Math.min(i.ordinal,a.ordinal);o.forEach(s=>{if(s.ordinal>m&&s.ordinal<c)d.push(s);else{if(s.ordinal==m||s.ordinal==c)return;u.push(s)}});let h=d;d.length>u.length&&(h=u),h.length==0?(l.ordinal=M(i,r),t=[l,i]):(l.ordinal=h[0].ordinal,o=o.filter(s=>!h.includes(s)),t=[l,i]),o=o.concat(t),e.forEach(s=>{s.cutLine&&(x=x.filter(w=>w!=s.cutLine))})}}else o=F(o,e[0],e[1]);o.sort((t,i)=>t.ordinal>i.ordinal?1:-1),x=x.filter(t=>o.some(i=>i.x==t.startX&&i.y==t.startY))}function B(){n.push(),n.fill("#f1eeeb"),n.beginShape();for(let e=0;e<o.length;e++)n.vertex(o[e].x,o[e].y);n.endShape(n.CLOSE);for(let e of x)n.line(e.startX,e.startY,e.endX,e.endY);n.pop();for(let e=0;e<o.length;e++);n.image(Y,0,0)}function R(){for(let e=0;e<12;e++)n.push(),n.rotate(n.PI*e/6),e%2==1&&(n.scale(-1,1),n.rotate(n.PI*5/6)),B(),n.pop()}function q(){X=!0}function A(){X=!1,Y.clear(),o=[{x:0,y:0,ordinal:0},{x:n.width/2.3,y:0,ordinal:500},{x:n.width/2.3-1,y:n.height/4,ordinal:1e3}],x=[]}function D(e,t,i,l){return(l-t)/(i-e)}function O(e,t,i){return t-i*e}function I(e,t,i){return Math.min(e,t)<=i&&i<=Math.max(e,t)}function W(e,t,i,l,a,r,d,u){let c=D(e,t,i,l),m=D(a,r,d,u);if(c===m)return null;let h=O(e,t,c),w=(O(a,r,m)-h)/(c-m),p=c*w+h;return I(e,i,w)&&I(t,l,p)&&I(a,d,w)&&I(r,u,p)?{x:w,y:p}:null}function E(e,t){let i=e.x,l=e.y,a=!1;for(let r=0,d=t.length-1;r<t.length;d=r++){let u=t[r].x,c=t[r].y,m=t[d].x,h=t[d].y;c>l!=h>l&&i<(m-u)*(l-c)/(h-c)+u&&(a=!a)}return a}function F(e,t,i){let l=t.flakeIndex,a=i.flakeIndex,r={x:t.x,y:t.y,ordinal:t.ordinal},d={x:i.x,y:i.y,ordinal:i.ordinal},u=[];if(l===a)return e;let c=e.length,m=(a-l+c)%c,h=(l-a+c)%c;return m<h?l<a?u=e.slice(0,l).concat(r,d).concat(e.slice(a)):u=e.slice(a,l+1).concat(d,r):l<a?u=e.slice(l,a).concat(d,r):u=e.slice(0,a).concat(d,r).concat(e.slice(l)),u=u.filter((s,w,p)=>w===p.findIndex(U=>U.x===s.x&&U.y===s.y)),u}function T(e,t,i,l){return Math.sqrt(Math.pow(i-e,2)+Math.pow(l-t,2))}function G(e,t){let i=t.slice();return i.sort((l,a)=>{let r=T(e.x,e.y,l.x,l.y),d=T(e.x,e.y,a.x,a.y);return r-d}),i}};new p5(j,y)}export{N as run};
