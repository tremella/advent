import"./vendor_p5js-wrapper-Hbg_u1xl.js";import"./vendor_p5-hFoC1Msr.js";import"./vendor_exenv-rXw0U8dN.js";function V(){const L=document.getElementById("snowflake");if(document.getElementById("snowflakeEmbed"))return;const k=document.createElement("div"),P=document.createElement("h1");P.innerText="Snowflake Craft Station",k.append(P);const C=document.createElement("p");C.innerText="Click and drag to cut the snowflake. Click 'Unfold Snowflake' to see the full design.",k.append(C);const E=document.createElement("button");E.innerText="Reset",k.append(E);const S=document.createElement("button");S.innerText="Unfold Snowflake",k.append(S);const b=document.createElement("div");b.id="snowflakeEmbed",k.append(b),L.append(k);const j=n=>{let y,x=[],Y=!1,f=null,o,H=n.windowWidth,R=n.windowHeight;n.setup=()=>{let e=Math.min(H,R)*.6,t=n.createCanvas(e,e).elt;y=n.createGraphics(200,200),o=[{x:0,y:0,ordinal:0},{x:n.width/2.3,y:0,ordinal:500},{x:n.width/2.3-1,y:n.height/4,ordinal:1e3}],y.translate(n.width/2,n.height/2),E.onclick=G,S.onclick=F,n.background(255);function i(l){l.preventDefault()}t.addEventListener("touchstart",i,{passive:!1}),t.addEventListener("touchmove",i,{passive:!1}),t.addEventListener("touchend",i,{passive:!1})},n.draw=()=>{if(n.translate(n.width/2,n.height/2),n.strokeWeight(1),n.stroke("#000"),n.background("#901a1a"),Y)n.stroke("#CCC"),A();else if(n.stroke("#000"),n.strokeWeight(2),B(),f){f.endX=n.mouseX-n.width/2,f.endY=n.mouseY-n.height/2;let{startX:e,startY:t,endX:i,endY:l}=f;n.line(e,t,i,l)}},n.mousePressed=()=>{if(!Y&&n.mouseX>0&&n.mouseX<n.width&&n.mouseY>0&&n.mouseY<n.height){let e=n.mouseX-n.width/2,t=n.mouseY-n.height/2;f={startX:e,startY:t,endX:null,endY:null}}},n.mouseReleased=()=>{if(f){let e=[];for(let l=0;l<o.length;l++){let a=o[l],d;l==0?d=o[o.length-1]:d=o[l-1];let r=W(d.x,d.y,a.x,a.y,f.startX,f.startY,f.endX,f.endY);r&&r.x&&(r.previous=a,r.flakeIndex=l,r.ordinal=M(d,a),e.push(r))}for(let l of x){let a=W(l.startX,l.startY,l.endX,l.endY,f.startX,f.startY,f.endX,f.endY);a&&(a.flakeIndex=null,a.cutLine=l,e.push(a))}let t={x:f.startX,y:f.startY},i={x:f.endX,y:f.endY};if(e.length==1)e[0].snap?e[0].snap=="start"?g(e[0],i):e[0].snap=="end"&&g(e[0],t):q(e[0],t,i);else if(e.length==2)X(e);else if(e.length>=3){let l=J(t,e),a=I(t,o),d=I(i,o);X(a?[l[1],l[2]]:d?[l[1],l[0]]:[l[0],l[1]])}n.push(),n.fill("red"),n.strokeWeight(20),n.pop(),f=null}};function M(e,t){if(e.ordinal>0&&t.ordinal>0)return(e.ordinal+t.ordinal)/2;if(e.ordinal==0&&o.indexOf(t)==1||t.ordinal==0&&o.indexOf(e)==1)return(e.ordinal+t.ordinal)/2;if(t.ordinal>0)return t.ordinal+500;if(e.ordinal>0)return e.ordinal+500}function q(e,t,i){let l=I(t,o),a=I(i,o);l&&a?g(t,i):l?g(e,t):a&&g(e,i)}function g(e,t){x.push({startX:e.x,startY:e.y,endX:t.x,endY:t.y,ordinal:e.ordinal}),o.splice(e.flakeIndex,0,e),o.sort((i,l)=>i.ordinal>l.ordinal?1:-1)}function X(e){if(e[0].ordinal==null||e[1].ordinal==null){let t=[];if(e[0].ordinal==null&&e[1].ordinal==null)return;{let i,l;e[0].ordinal==null?(i=e[1],l=e[0]):(i=e[0],l=e[1]);let a=l.cutLine,d={x:a.startX,y:a.startY,ordinal:a.ordinal},r=[],u=[],c=Math.max(i.ordinal,a.ordinal),m=Math.min(i.ordinal,a.ordinal);o.forEach(s=>{if(s.ordinal>m&&s.ordinal<c)r.push(s);else{if(s.ordinal==m||s.ordinal==c)return;u.push(s)}});let h=r;r.length>u.length&&(h=u),h.length==0?(l.ordinal=M(i,d),t=[l,i]):(l.ordinal=h[0].ordinal,o=o.filter(s=>!h.includes(s)),t=[l,i]),o=o.concat(t),e.forEach(s=>{s.cutLine&&(x=x.filter(w=>w!=s.cutLine))})}}else o=z(o,e[0],e[1]);o.sort((t,i)=>t.ordinal>i.ordinal?1:-1),x=x.filter(t=>o.some(i=>i.x==t.startX&&i.y==t.startY))}function B(){n.push(),n.fill("#f1eeeb"),n.beginShape();for(let e=0;e<o.length;e++)n.vertex(o[e].x,o[e].y);n.endShape(n.CLOSE);for(let e of x)n.line(e.startX,e.startY,e.endX,e.endY);n.pop();for(let e=0;e<o.length;e++);n.image(y,0,0)}function A(){for(let e=0;e<12;e++)n.push(),n.rotate(n.PI*e/6),e%2==1&&(n.scale(-1,1),n.rotate(n.PI*5/6)),B(),n.pop()}function F(){Y=!0}function G(){Y=!1,y.clear(),o=[{x:0,y:0,ordinal:0},{x:n.width/2.3,y:0,ordinal:500},{x:n.width/2.3-1,y:n.height/4,ordinal:1e3}],x=[]}function D(e,t,i,l){return(l-t)/(i-e)}function O(e,t,i){return t-i*e}function v(e,t,i){return Math.min(e,t)<=i&&i<=Math.max(e,t)}function W(e,t,i,l,a,d,r,u){let c=D(e,t,i,l),m=D(a,d,r,u);if(c===m)return null;let h=O(e,t,c),w=(O(a,d,m)-h)/(c-m),p=c*w+h;return v(e,i,w)&&v(t,l,p)&&v(a,r,w)&&v(d,u,p)?{x:w,y:p}:null}function I(e,t){let i=e.x,l=e.y,a=!1;for(let d=0,r=t.length-1;d<t.length;r=d++){let u=t[d].x,c=t[d].y,m=t[r].x,h=t[r].y;c>l!=h>l&&i<(m-u)*(l-c)/(h-c)+u&&(a=!a)}return a}function z(e,t,i){let l=t.flakeIndex,a=i.flakeIndex,d={x:t.x,y:t.y,ordinal:t.ordinal},r={x:i.x,y:i.y,ordinal:i.ordinal},u=[];if(l===a)return e;let c=e.length,m=(a-l+c)%c,h=(l-a+c)%c;return m<h?l<a?u=e.slice(0,l).concat(d,r).concat(e.slice(a)):u=e.slice(a,l+1).concat(r,d):l<a?u=e.slice(l,a).concat(r,d):u=e.slice(0,a).concat(r,d).concat(e.slice(l)),u=u.filter((s,w,p)=>w===p.findIndex(U=>U.x===s.x&&U.y===s.y)),u}function T(e,t,i,l){return Math.sqrt(Math.pow(i-e,2)+Math.pow(l-t,2))}function J(e,t){let i=t.slice();return i.sort((l,a)=>{let d=T(e.x,e.y,l.x,l.y),r=T(e.x,e.y,a.x,a.y);return d-r}),i}};new p5(j,L)}export{V as run};
